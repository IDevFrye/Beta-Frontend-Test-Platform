<!DOCTYPE html>
<html>

<head>
  <title>Test BSL-editor</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.1.0/mocha.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.1.0/mocha.js"></script>
  <script>
    mocha.setup('bdd');
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/2.0.0/chai.js"></script>  
  <link href="./decorations.css" rel="stylesheet">
  <link href="./tree/tree.css" rel="stylesheet">
  <link href="./tingle.css" rel="stylesheet">
  <script src="./tingle.js"></script>
</head>

<body>

  <script>
    function getCode() {
      return [
        '// Это тестовая функция',
        'Функция Тестовая(Парам1, Парам2, Парам3) Экспорт',
        '',
        ' Док = Документы.АвансовыйОтчет.НайтиПоНомеру(1);',
        ' Док.Записать',
        ' Товар.Цена',
        '',
        'Запрос = ',
        '"ВЫБРАТЬ',
        '|ИЗ',
        '|Справочники";',
        '',
        'Если Истина Тогда',        
        '	Выполнить(ТекстКода);',
       	'	Счетчик = Счетчик + 1',
       	'	Состояние("Выполнено " + Счетчик + " из " + Всего);',        
        'КонецЕсли;',
        '',        
        'Пока Истина Цикл',        
        '	Выполнить(ТекстКода);',
       	'	Счетчик = Счетчик + 1',
       	'	Состояние("Выполнено " + Счетчик + " из " + Всего);',        
        'КонецЦикла;',
        '',        
        'Для Индекс = 1 По 5 Цикл',        
        '	Выполнить(ТекстКода);',
       	'	Счетчик = Счетчик + 1',
       	'	Состояние("Выполнено " + Счетчик + " из " + Всего);',        
        'КонецЦикла;',
        '',                
        'ТаблицаЗначений.Найти(Справочники.',
        '',
        ' Стр = ОписаниеОшибки',
        '',
        ' Новый ТаблицаЗначений',
        '',
        ' Новый HTTPЗапрос',
        '',
        ' Найти(HTTPЗапрос',
        '',
        ' ТаблицаЗначений.Добавить',
        '',
        ' СтрНайти',
        '',
        ' HTTPЗапрос.УстановитьТелоИзСтроки',
        '',
        'ЧислоСтр = Формат(Число, "ЧЦ=15; ЧДЦ=2; ЧГ=0")',
        '',
        'Запрос = Новый HTTPЗапрос();',
        'Запрос.',
        '',        
        '\tЗапрос = Новый Запрос("ВЫБРАТЬ',
        '\t|	АвансовыйОтчет.ВалютаДокумента КАК ВалютаДокумента,',
        '\t|	АвансовыйОтчет.ВидОперации КАК ВидОперации,',
        '\t|	АвансовыйОтчет.Комментарий КАК Комментарий,',
        '\t|	АвансовыйОтчет.КурсДокумента КАК КурсДокумента,',
        '\t|	""ИСТИНА"" КАК Поле1,',
        '\t|	ВЫБОР',
        '\t|		КОГДА АвансовыйОтчет.ФизЛицо = ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка)',
        '\t|			ТОГДА ИСТИНА',
        '\t|		ИНАЧЕ ""ЛОЖЬ""',
        '\t|	КОНЕЦ КАК Поле2',
        '\t|ИЗ',
        '\t|	Документ.АвансовыйОтчет КАК АвансовыйОтчет");',
        '\t',
        '\tРезультат = Запрос.',
        '\t',
        '',
        '// Начало проверки форматирования для попытки и условия',
        'Попытка',
        ' Док = Документы.АвансовыйОтчет.НайтиПоНомеру(1);',                
        'Исключение',
        'Сообщить("Ошибка");',
        'КонецПопытки;',
        '',
        'Если Истина Тогда',
        'Если Истина Тогда',
        ' Док = Документы.АвансовыйОтчет.НайтиПоНомеру(1);',                        
        'ИначеЕсли Ложь Тогда',
        'Док = Документы.РасходнаяНакладная.НайтиПоНомеру(1);',
        'КонецЕсли;',
        'Иначе',
        'Если Истина Тогда',
        'Док = Документы.РасходнаяНакладная.НайтиПоНомеру(1);',
        'Иначе',
        'Док = Документы.ПриходнаяНакладная.НайтиПоНомеру(1);',
        'КонецЕсли;',        
        'КонецЕсли;',        
        '// Конец проверки форматирования для попытки и условия',
        '',
        '// Проверка подсказки по стеку',
        '',
        ' ПервыйДокумент = Документы.АвансовыйОтчет.НайтиПоНомеру(1);',
        ' ВторойДокумент = ПервыйДокумент.ПолучитьОбъект();',
        ' ВторойДокумент.',
        '',
        ' ПервыйСправочник = Справочники.Товары.НайтиПоКоду(1);',
        ' ВторойСправочник = ПервыйСправочник.СоставнойРеквизит;',
        ' ТретийСправочник = ВторойСправочник.ПолучитьОбъект();',
        ' ТретийСправочник.',
        '',        
        ' ЧетвертыйСправочник = ТоварСсылка.СоставнойРеквизит.Товар.ПолучитьОбъект();',
        ' ПятыйСправочник = ЧетвертыйСправочник.СтавкаНДС.ПолучитьОбъект()',
        ' ПятыйСправочник.',
        '',
        ' ПользовательскийТовар = _ОбъектСВложениями.Товар.ПолучитьОбъект();',
        ' ПользовательскийТовар.',
        '',
        ' Запрос = Новый Запрос;',
        ' Запрос.Текст = "ВЫБРАТЬ 1";',
        ' Результат = Запрос.Выполнить();',
        ' Выборка = Результат.Выбрать();',
        ' Пока Выборка.Следующий() Цикл',
        '   Выборка.',
        ' КонецЦикла;',
        '',
        '// Конец проверки подсказки по стеку',
        '',
        ' // Проверка вывода цветов',
        ' Структура = Новый Структура();',
        ' Структура.Вставить("Web", WebЦвета.Аквамарин);',
        ' Структура.Вставить("Web", Новый Цвет(100, 150, 100));',
        ' Структура.Вставить("Web", "WebЦвета.Аквамарин");',
        '',
        ' // Проверка сворачивания областей и инструкций',
        ' #Область Параметры',
        ' #Если Сервер Тогда',
        '     А = 1;',
        ' #КонецЕсли',
        ' #КонецОбласти',
        '',
        ' #Если Клиент Тогда',
        ' #Если ВебКлиент Тогда',
        '     А = 1;',
        ' #КонецЕсли',
        ' #КонецЕсли',
        '',
        ' Для Каждого Обход Из Параметры Цикл',
        '     #Если ВебКлиент Тогда',
        '         А = 1;',
        '     #КонецЕсли',
        ' КонецЦикла;',
        'КонецФункции',
        '',
        '// Конец проверки сворачивания',
        '',
        '// Проверка подсказки описания метаданных',
        '',
        ' Товар = Справочники.Товары.НайтиПоКоду(1);',
        ' Метаданные = Товар.Метаданные();',
        ' Метаданные.',
        '',
        '// Конец проверки подсказки описани метаданных',
        '',
        '// Проверка подсветки строковых литералов',
        'начКаталог = "D:\\Temp\\1\\"; ЭтотКодНеДолженПодсвечиватьсяКакТекст = Неопределено;',
        'ИмяФайла = "C:\\TerminalDisk\\Журнал регистрации1.lgf";',
        'Двойные = "ООО ""Двойные кавычки""";',
        'СтрокаПрограммы = """(?:(?:"""")|[^""\\n])*(?:(?://[^\\n]*\\n|\\s|^|$)*\\|(?:(?:"""")|[^""\\n])*)*(?:""|$)";',
        'Имя = "[_ЁА-ЯA-Z][_ЁА-ЯA-Z\\d]*";',
        'Разделитель = "(?://[^\\n]*\\n|\\s|^|$)";',
        'БлокКомментариев = "(?:(?:\\t| )*//[^\\n]*\\n)+(?:(?:\\t| )*(?:\\r|$))+";',
        '// Конец проверки подсветки строковых литералов',
        '',
        '// Проверка подсветки запроса с двойными кавычками в конце строки',
        'Запрос = Новый Запрос(',
        '"ВЫБРАТЬ',
        '|	*',
        '|ИЗ',
        '|	Справочник.Номенклатура КАК Номенклатура',
        '|ГДЕ ',
        '|    Номенклатура.Наименование ПОДОБНО ""%(%""");',
        '',
        'Выборка = Запрос.Выполнить().Выполнить();',
        '',
        'Пока Выборка.Следующий() Цикл',
        '// Код',
        'КонецЦикла;',
        '',
        'Запрос = Новый Запрос;',
        'Запрос.Текст = "ВЫБРАТЬ',
        '|1 КАК Поле1',
        '|ГДЕ',
        '|	"""" = """"";',
        'Результат = Запрос.Выполнить();',
        '// Конец проверки подсветки строковых литералов',
        '',
      ].join('\n');;
    }
  </script>

  <div id="container" style="width:100%;height:400px;border:1px solid grey"></div>  
  <div id="display">
    <div id="display-header">
      <div id="display-title"></div>
      <div id="display-close"></div>
    </div>
    <div id="variables-display">
      <div id="variables-tree"></div>
    </div>    
  </div>
  <button id="event-button"></button>

  <script src="./vs/loader.js"></script>
  <script src="./parsers.js"></script>
  <script src="./finder.js"></script>
  <script src="./bsl_helper.js"></script>
  <script src="./test.js"></script>
  <script src="./tree/tree.js"></script>

  <div id="mocha"></div>

</body>

</html>